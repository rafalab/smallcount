---
title: "smallcount i/o comparison"
shorttitle: "check on scuttle"
date: "`r format(Sys.time(), '%B %d, %Y')`"
vignette: >
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteIndexEntry{smallcount}
  %\VignetteEncoding{UTF-8}
output:
  BiocStyle::html_document:
    highlight: pygments
    number_sections: yes
    theme: united
    toc: yes
---

# Genes in rows

## Setup

```{r code}
suppressPackageStartupMessages({
library(smallcount)
library(bench)
library(Matrix)
library(scuttle)
})
```
 
Define a function that retrieves dgCmatrix from CSV using Rafa's script

```{r mkfun}
raf1 = function() {
read_sparse_csv(system.file("extdata/tenx_subset.csv.gz", package="smallcount"))
}
```

Benchmark it


```{r run2}
mark( raf1(), iterations=2)
```

Benchmark Aaron's code in scuttle

```{r doscut}
doaaron = function() {
con = gzfile(system.file("extdata/tenx_subset.csv.gz", package="smallcount"), "r" )
on.exit(close(con))
readSparseCounts(con, sep=",")
}
mark(doaaron(), iterations=2)
```

# Genes in columns

Use rafa script

```{r runtr}
raf2 = function() {
read_sparse_csv_transpose(system.file("extdata/tenx_subset-transpose.csv.gz", package="smallcount"))
}
mark( raf2(), iterations=2)
```

Aaron:

```{r aartr}
doaaron_t = function() {
con = gzfile(system.file("extdata/tenx_subset-transpose.csv.gz", package="smallcount"), "r" )
on.exit(close(con))
readSparseCounts(con, sep=",")
}
mark(doaaron_t(), iterations=2)
```
